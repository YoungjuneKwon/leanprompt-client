(function(D,R){typeof exports=="object"&&typeof module<"u"?R(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],R):(D=typeof globalThis<"u"?globalThis:D||self,R(D.LeanPromptClient={},D.React))})(this,function(D,R){"use strict";var Zt=Object.defineProperty;var qt=(D,R,B)=>R in D?Zt(D,R,{enumerable:!0,configurable:!0,writable:!0,value:B}):D[R]=B;var F=(D,R,B)=>qt(D,typeof R!="symbol"?R+"":R,B);function B(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var oe={exports:{}},J={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Se;function st(){if(Se)return J;Se=1;var n=R,r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,f=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,b={key:!0,ref:!0,__self:!0,__source:!0};function g(w,_,S){var c,d={},v=null,l=null;S!==void 0&&(v=""+S),_.key!==void 0&&(v=""+_.key),_.ref!==void 0&&(l=_.ref);for(c in _)i.call(_,c)&&!b.hasOwnProperty(c)&&(d[c]=_[c]);if(w&&w.defaultProps)for(c in _=w.defaultProps,_)d[c]===void 0&&(d[c]=_[c]);return{$$typeof:r,type:w,key:v,ref:l,props:d,_owner:f.current}}return J.Fragment=s,J.jsx=g,J.jsxs=g,J}var $={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var he;function at(){return he||(he=1,process.env.NODE_ENV!=="production"&&function(){var n=R,r=Symbol.for("react.element"),s=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),f=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),g=Symbol.for("react.provider"),w=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),c=Symbol.for("react.suspense_list"),d=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),l=Symbol.for("react.offscreen"),m=Symbol.iterator,a="@@iterator";function T(e){if(e===null||typeof e!="object")return null;var t=m&&e[m]||e[a];return typeof t=="function"?t:null}var C=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function y(e){{for(var t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];I("error",e,o)}}function I(e,t,o){{var u=C.ReactDebugCurrentFrame,h=u.getStackAddendum();h!==""&&(t+="%s",o=o.concat([h]));var O=o.map(function(E){return String(E)});O.unshift("Warning: "+t),Function.prototype.apply.call(console[e],console,O)}}var W=!1,U=!1,P=!1,L=!1,G=!1,xe;xe=Symbol.for("react.module.reference");function Ot(e){return!!(typeof e=="string"||typeof e=="function"||e===i||e===b||G||e===f||e===S||e===c||L||e===l||W||U||P||typeof e=="object"&&e!==null&&(e.$$typeof===v||e.$$typeof===d||e.$$typeof===g||e.$$typeof===w||e.$$typeof===_||e.$$typeof===xe||e.getModuleId!==void 0))}function Rt(e,t,o){var u=e.displayName;if(u)return u;var h=t.displayName||t.name||"";return h!==""?o+"("+h+")":o}function Me(e){return e.displayName||"Context"}function N(e){if(e==null)return null;if(typeof e.tag=="number"&&y("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case i:return"Fragment";case s:return"Portal";case b:return"Profiler";case f:return"StrictMode";case S:return"Suspense";case c:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case w:var t=e;return Me(t)+".Consumer";case g:var o=e;return Me(o._context)+".Provider";case _:return Rt(e,e.render,"ForwardRef");case d:var u=e.displayName||null;return u!==null?u:N(e.type)||"Memo";case v:{var h=e,O=h._payload,E=h._init;try{return N(E(O))}catch{return null}}}return null}var Y=Object.assign,X=0,Ie,We,Ve,Fe,Ne,Ue,Ge;function Ye(){}Ye.__reactDisabledLog=!0;function wt(){{if(X===0){Ie=console.log,We=console.info,Ve=console.warn,Fe=console.error,Ne=console.group,Ue=console.groupCollapsed,Ge=console.groupEnd;var e={configurable:!0,enumerable:!0,value:Ye,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}X++}}function Tt(){{if(X--,X===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:Y({},e,{value:Ie}),info:Y({},e,{value:We}),warn:Y({},e,{value:Ve}),error:Y({},e,{value:Fe}),group:Y({},e,{value:Ne}),groupCollapsed:Y({},e,{value:Ue}),groupEnd:Y({},e,{value:Ge})})}X<0&&y("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var le=C.ReactCurrentDispatcher,fe;function ee(e,t,o){{if(fe===void 0)try{throw Error()}catch(h){var u=h.stack.trim().match(/\n( *(at )?)/);fe=u&&u[1]||""}return`
`+fe+e}}var de=!1,te;{var Ct=typeof WeakMap=="function"?WeakMap:Map;te=new Ct}function He(e,t){if(!e||de)return"";{var o=te.get(e);if(o!==void 0)return o}var u;de=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var O;O=le.current,le.current=null,wt();try{if(t){var E=function(){throw Error()};if(Object.defineProperty(E.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(E,[])}catch(x){u=x}Reflect.construct(e,[],E)}else{try{E.call()}catch(x){u=x}e.call(E.prototype)}}else{try{throw Error()}catch(x){u=x}e()}}catch(x){if(x&&u&&typeof x.stack=="string"){for(var p=x.stack.split(`
`),k=u.stack.split(`
`),A=p.length-1,j=k.length-1;A>=1&&j>=0&&p[A]!==k[j];)j--;for(;A>=1&&j>=0;A--,j--)if(p[A]!==k[j]){if(A!==1||j!==1)do if(A--,j--,j<0||p[A]!==k[j]){var M=`
`+p[A].replace(" at new "," at ");return e.displayName&&M.includes("<anonymous>")&&(M=M.replace("<anonymous>",e.displayName)),typeof e=="function"&&te.set(e,M),M}while(A>=1&&j>=0);break}}}finally{de=!1,le.current=O,Tt(),Error.prepareStackTrace=h}var Q=e?e.displayName||e.name:"",H=Q?ee(Q):"";return typeof e=="function"&&te.set(e,H),H}function Pt(e,t,o){return He(e,!1)}function At(e){var t=e.prototype;return!!(t&&t.isReactComponent)}function re(e,t,o){if(e==null)return"";if(typeof e=="function")return He(e,At(e));if(typeof e=="string")return ee(e);switch(e){case S:return ee("Suspense");case c:return ee("SuspenseList")}if(typeof e=="object")switch(e.$$typeof){case _:return Pt(e.render);case d:return re(e.type,t,o);case v:{var u=e,h=u._payload,O=u._init;try{return re(O(h),t,o)}catch{}}}return""}var Z=Object.prototype.hasOwnProperty,Be={},Ke=C.ReactDebugCurrentFrame;function ne(e){if(e){var t=e._owner,o=re(e.type,e._source,t?t.type:null);Ke.setExtraStackFrame(o)}else Ke.setExtraStackFrame(null)}function jt(e,t,o,u,h){{var O=Function.call.bind(Z);for(var E in e)if(O(e,E)){var p=void 0;try{if(typeof e[E]!="function"){var k=Error((u||"React class")+": "+o+" type `"+E+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[E]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw k.name="Invariant Violation",k}p=e[E](t,E,u,o,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(A){p=A}p&&!(p instanceof Error)&&(ne(h),y("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",u||"React class",o,E,typeof p),ne(null)),p instanceof Error&&!(p.message in Be)&&(Be[p.message]=!0,ne(h),y("Failed %s type: %s",o,p.message),ne(null))}}}var Dt=Array.isArray;function ve(e){return Dt(e)}function Lt(e){{var t=typeof Symbol=="function"&&Symbol.toStringTag,o=t&&e[Symbol.toStringTag]||e.constructor.name||"Object";return o}}function kt(e){try{return ze(e),!1}catch{return!0}}function ze(e){return""+e}function Qe(e){if(kt(e))return y("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",Lt(e)),ze(e)}var Je=C.ReactCurrentOwner,xt={key:!0,ref:!0,__self:!0,__source:!0},$e,Xe;function Mt(e){if(Z.call(e,"ref")){var t=Object.getOwnPropertyDescriptor(e,"ref").get;if(t&&t.isReactWarning)return!1}return e.ref!==void 0}function It(e){if(Z.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return e.key!==void 0}function Wt(e,t){typeof e.ref=="string"&&Je.current}function Vt(e,t){{var o=function(){$e||($e=!0,y("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};o.isReactWarning=!0,Object.defineProperty(e,"key",{get:o,configurable:!0})}}function Ft(e,t){{var o=function(){Xe||(Xe=!0,y("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};o.isReactWarning=!0,Object.defineProperty(e,"ref",{get:o,configurable:!0})}}var Nt=function(e,t,o,u,h,O,E){var p={$$typeof:r,type:e,key:t,ref:o,props:E,_owner:O};return p._store={},Object.defineProperty(p._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(p,"_self",{configurable:!1,enumerable:!1,writable:!1,value:u}),Object.defineProperty(p,"_source",{configurable:!1,enumerable:!1,writable:!1,value:h}),Object.freeze&&(Object.freeze(p.props),Object.freeze(p)),p};function Ut(e,t,o,u,h){{var O,E={},p=null,k=null;o!==void 0&&(Qe(o),p=""+o),It(t)&&(Qe(t.key),p=""+t.key),Mt(t)&&(k=t.ref,Wt(t,h));for(O in t)Z.call(t,O)&&!xt.hasOwnProperty(O)&&(E[O]=t[O]);if(e&&e.defaultProps){var A=e.defaultProps;for(O in A)E[O]===void 0&&(E[O]=A[O])}if(p||k){var j=typeof e=="function"?e.displayName||e.name||"Unknown":e;p&&Vt(E,j),k&&Ft(E,j)}return Nt(e,p,k,h,u,Je.current,E)}}var me=C.ReactCurrentOwner,Ze=C.ReactDebugCurrentFrame;function z(e){if(e){var t=e._owner,o=re(e.type,e._source,t?t.type:null);Ze.setExtraStackFrame(o)}else Ze.setExtraStackFrame(null)}var pe;pe=!1;function _e(e){return typeof e=="object"&&e!==null&&e.$$typeof===r}function qe(){{if(me.current){var e=N(me.current.type);if(e)return`

Check the render method of \``+e+"`."}return""}}function Gt(e){return""}var et={};function Yt(e){{var t=qe();if(!t){var o=typeof e=="string"?e:e.displayName||e.name;o&&(t=`

Check the top-level render call using <`+o+">.")}return t}}function tt(e,t){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var o=Yt(t);if(et[o])return;et[o]=!0;var u="";e&&e._owner&&e._owner!==me.current&&(u=" It was passed a child from "+N(e._owner.type)+"."),z(e),y('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',o,u),z(null)}}function rt(e,t){{if(typeof e!="object")return;if(ve(e))for(var o=0;o<e.length;o++){var u=e[o];_e(u)&&tt(u,t)}else if(_e(e))e._store&&(e._store.validated=!0);else if(e){var h=T(e);if(typeof h=="function"&&h!==e.entries)for(var O=h.call(e),E;!(E=O.next()).done;)_e(E.value)&&tt(E.value,t)}}}function Ht(e){{var t=e.type;if(t==null||typeof t=="string")return;var o;if(typeof t=="function")o=t.propTypes;else if(typeof t=="object"&&(t.$$typeof===_||t.$$typeof===d))o=t.propTypes;else return;if(o){var u=N(t);jt(o,e.props,"prop",u,e)}else if(t.PropTypes!==void 0&&!pe){pe=!0;var h=N(t);y("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",h||"Unknown")}typeof t.getDefaultProps=="function"&&!t.getDefaultProps.isReactClassApproved&&y("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Bt(e){{for(var t=Object.keys(e.props),o=0;o<t.length;o++){var u=t[o];if(u!=="children"&&u!=="key"){z(e),y("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",u),z(null);break}}e.ref!==null&&(z(e),y("Invalid attribute `ref` supplied to `React.Fragment`."),z(null))}}var nt={};function ot(e,t,o,u,h,O){{var E=Ot(e);if(!E){var p="";(e===void 0||typeof e=="object"&&e!==null&&Object.keys(e).length===0)&&(p+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var k=Gt();k?p+=k:p+=qe();var A;e===null?A="null":ve(e)?A="array":e!==void 0&&e.$$typeof===r?(A="<"+(N(e.type)||"Unknown")+" />",p=" Did you accidentally export a JSX literal instead of a component?"):A=typeof e,y("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",A,p)}var j=Ut(e,t,o,h,O);if(j==null)return j;if(E){var M=t.children;if(M!==void 0)if(u)if(ve(M)){for(var Q=0;Q<M.length;Q++)rt(M[Q],e);Object.freeze&&Object.freeze(M)}else y("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else rt(M,e)}if(Z.call(t,"key")){var H=N(e),x=Object.keys(t).filter(function(Xt){return Xt!=="key"}),Ee=x.length>0?"{key: someKey, "+x.join(": ..., ")+": ...}":"{key: someKey}";if(!nt[H+Ee]){var $t=x.length>0?"{"+x.join(": ..., ")+": ...}":"{}";y(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Ee,H,$t,H),nt[H+Ee]=!0}}return e===i?Bt(j):Ht(j),j}}function Kt(e,t,o){return ot(e,t,o,!0)}function zt(e,t,o){return ot(e,t,o,!1)}var Qt=zt,Jt=Kt;$.Fragment=i,$.jsx=Qt,$.jsxs=Jt}()),$}process.env.NODE_ENV==="production"?oe.exports=st():oe.exports=at();var it=oe.exports;const ge=R.createContext(null),ut=({children:n,config:r})=>{const s={config:r};return it.jsx(ge.Provider,{value:s,children:n})},be=()=>{const n=R.useContext(ge);if(!n)throw new Error("useLeanPromptContext must be used within a LeanPromptProvider");return n},ct={},ye=n=>{let r;const s=new Set,i=(c,d)=>{const v=typeof c=="function"?c(r):c;if(!Object.is(v,r)){const l=r;r=d??(typeof v!="object"||v===null)?v:Object.assign({},r,v),s.forEach(m=>m(r,l))}},f=()=>r,_={setState:i,getState:f,getInitialState:()=>S,subscribe:c=>(s.add(c),()=>s.delete(c)),destroy:()=>{(ct?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},S=r=n(i,f,_);return _},lt=n=>n?ye(n):ye;var se={exports:{}},ae={},q={exports:{}},ie={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oe;function ft(){if(Oe)return ie;Oe=1;var n=R;function r(d,v){return d===v&&(d!==0||1/d===1/v)||d!==d&&v!==v}var s=typeof Object.is=="function"?Object.is:r,i=n.useState,f=n.useEffect,b=n.useLayoutEffect,g=n.useDebugValue;function w(d,v){var l=v(),m=i({inst:{value:l,getSnapshot:v}}),a=m[0].inst,T=m[1];return b(function(){a.value=l,a.getSnapshot=v,_(a)&&T({inst:a})},[d,l,v]),f(function(){return _(a)&&T({inst:a}),d(function(){_(a)&&T({inst:a})})},[d]),g(l),l}function _(d){var v=d.getSnapshot;d=d.value;try{var l=v();return!s(d,l)}catch{return!0}}function S(d,v){return v()}var c=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?S:w;return ie.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:c,ie}var ue={};/**
 * @license React
 * use-sync-external-store-shim.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Re;function dt(){return Re||(Re=1,process.env.NODE_ENV!=="production"&&function(){function n(l,m){return l===m&&(l!==0||1/l===1/m)||l!==l&&m!==m}function r(l,m){c||f.startTransition===void 0||(c=!0,console.error("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var a=m();if(!d){var T=m();b(a,T)||(console.error("The result of getSnapshot should be cached to avoid an infinite loop"),d=!0)}T=g({inst:{value:a,getSnapshot:m}});var C=T[0].inst,y=T[1];return _(function(){C.value=a,C.getSnapshot=m,s(C)&&y({inst:C})},[l,a,m]),w(function(){return s(C)&&y({inst:C}),l(function(){s(C)&&y({inst:C})})},[l]),S(a),a}function s(l){var m=l.getSnapshot;l=l.value;try{var a=m();return!b(l,a)}catch{return!0}}function i(l,m){return m()}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var f=R,b=typeof Object.is=="function"?Object.is:n,g=f.useState,w=f.useEffect,_=f.useLayoutEffect,S=f.useDebugValue,c=!1,d=!1,v=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?i:r;ue.useSyncExternalStore=f.useSyncExternalStore!==void 0?f.useSyncExternalStore:v,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()),ue}var we;function Te(){return we||(we=1,process.env.NODE_ENV==="production"?q.exports=ft():q.exports=dt()),q.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ce;function vt(){if(Ce)return ae;Ce=1;var n=R,r=Te();function s(S,c){return S===c&&(S!==0||1/S===1/c)||S!==S&&c!==c}var i=typeof Object.is=="function"?Object.is:s,f=r.useSyncExternalStore,b=n.useRef,g=n.useEffect,w=n.useMemo,_=n.useDebugValue;return ae.useSyncExternalStoreWithSelector=function(S,c,d,v,l){var m=b(null);if(m.current===null){var a={hasValue:!1,value:null};m.current=a}else a=m.current;m=w(function(){function C(P){if(!y){if(y=!0,I=P,P=v(P),l!==void 0&&a.hasValue){var L=a.value;if(l(L,P))return W=L}return W=P}if(L=W,i(I,P))return L;var G=v(P);return l!==void 0&&l(L,G)?(I=P,L):(I=P,W=G)}var y=!1,I,W,U=d===void 0?null:d;return[function(){return C(c())},U===null?void 0:function(){return C(U())}]},[c,d,v,l]);var T=f(S,m[0],m[1]);return g(function(){a.hasValue=!0,a.value=T},[T]),_(T),T},ae}var ce={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pe;function mt(){return Pe||(Pe=1,process.env.NODE_ENV!=="production"&&function(){function n(S,c){return S===c&&(S!==0||1/S===1/c)||S!==S&&c!==c}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var r=R,s=Te(),i=typeof Object.is=="function"?Object.is:n,f=s.useSyncExternalStore,b=r.useRef,g=r.useEffect,w=r.useMemo,_=r.useDebugValue;ce.useSyncExternalStoreWithSelector=function(S,c,d,v,l){var m=b(null);if(m.current===null){var a={hasValue:!1,value:null};m.current=a}else a=m.current;m=w(function(){function C(P){if(!y){if(y=!0,I=P,P=v(P),l!==void 0&&a.hasValue){var L=a.value;if(l(L,P))return W=L}return W=P}if(L=W,i(I,P))return L;var G=v(P);return l!==void 0&&l(L,G)?(I=P,L):(I=P,W=G)}var y=!1,I,W,U=d===void 0?null:d;return[function(){return C(c())},U===null?void 0:function(){return C(U())}]},[c,d,v,l]);var T=f(S,m[0],m[1]);return g(function(){a.hasValue=!0,a.value=T},[T]),_(T),T},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()),ce}process.env.NODE_ENV==="production"?se.exports=vt():se.exports=mt();var pt=se.exports;const _t=B(pt),Ae={},{useDebugValue:Et}=R,{useSyncExternalStoreWithSelector:St}=_t;let je=!1;const ht=n=>n;function gt(n,r=ht,s){(Ae?"production":void 0)!=="production"&&s&&!je&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),je=!0);const i=St(n.subscribe,n.getState,n.getServerState||n.getInitialState,r,s);return Et(i),i}const De=n=>{(Ae?"production":void 0)!=="production"&&typeof n!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const r=typeof n=="function"?lt(n):n,s=(i,f)=>gt(r,i,f);return Object.assign(s,r),s},bt=n=>n?De(n):De,Le=()=>({messages:[],status:"idle"}),V=bt((n,r)=>({sessions:{},connectionStatus:"disconnected",connectionError:void 0,setSessionStatus:(s,i)=>n(f=>({sessions:{...f.sessions,[s]:{...f.sessions[s],status:i}}})),addMessage:(s,i)=>n(f=>{const b=f.sessions[s]||Le();return{sessions:{...f.sessions,[s]:{...b,messages:[...b.messages,{...i,timestamp:Date.now()}]}}}}),setSessionError:(s,i)=>n(f=>({sessions:{...f.sessions,[s]:{...f.sessions[s],status:"error",error:i}}})),clearSession:s=>n(i=>({sessions:{...i.sessions,[s]:Le()}})),setConnectionStatus:s=>n({connectionStatus:s,connectionError:void 0}),setConnectionError:s=>n({connectionStatus:"error",connectionError:s})}));class ke{constructor(r){F(this,"ws",null);F(this,"config");F(this,"reconnectAttempts",0);F(this,"reconnectTimer",null);F(this,"messageQueue",new Map);F(this,"debounceTimers",new Map);F(this,"messageHandlers",new Set);F(this,"connectionHandlers",new Set);this.config={baseUrl:r.baseUrl.replace(/\/$/,""),clientId:r.clientId||`client-${Math.random().toString(36).substr(2,9)}`,reconnectAttempts:r.reconnectAttempts||5,reconnectDelay:r.reconnectDelay||1e3,debounceMs:r.debounceMs||300}}connect(){return new Promise((r,s)=>{var b;if(((b=this.ws)==null?void 0:b.readyState)===WebSocket.OPEN){r();return}this.setConnectionStatus("connecting");const i=`${this.config.baseUrl}/ws/${this.config.clientId}`;this.ws=new WebSocket(i);const f=setTimeout(()=>{s(new Error("Connection timeout"))},1e4);this.ws.onopen=()=>{clearTimeout(f),this.reconnectAttempts=0,this.setConnectionStatus("connected"),this.processMessageQueue(),r()},this.ws.onmessage=g=>{try{const w=JSON.parse(g.data);this.messageHandlers.forEach(_=>_(w))}catch(w){console.error("Failed to parse WebSocket message:",w)}},this.ws.onclose=()=>{clearTimeout(f),this.setConnectionStatus("disconnected"),this.handleReconnect()},this.ws.onerror=g=>{clearTimeout(f),this.setConnectionStatus("error"),console.error("WebSocket error:",g),s(g)}})}disconnect(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.debounceTimers.forEach(r=>clearTimeout(r)),this.debounceTimers.clear(),this.ws&&(this.ws.close(),this.ws=null),this.setConnectionStatus("disconnected")}send(r,s){return new Promise((i,f)=>{const b={path:r,message:s};this.messageQueue.has(r)||this.messageQueue.set(r,[]),this.messageQueue.get(r).push(b),this.debounceSend(r),i()})}debounceSend(r){const s=this.debounceTimers.get(r);s&&clearTimeout(s);const i=window.setTimeout(()=>{this.processQueueForPath(r),this.debounceTimers.delete(r)},this.config.debounceMs);this.debounceTimers.set(r,i)}processQueueForPath(r){var f;if(((f=this.ws)==null?void 0:f.readyState)!==WebSocket.OPEN)return;const s=this.messageQueue.get(r);if(!s||s.length===0)return;const i=s[s.length-1];try{this.ws.send(JSON.stringify(i)),this.messageQueue.set(r,[])}catch(b){console.error("Failed to send WebSocket message:",b)}}processMessageQueue(){var r;((r=this.ws)==null?void 0:r.readyState)===WebSocket.OPEN&&Array.from(this.messageQueue.keys()).forEach(s=>{this.processQueueForPath(s)})}handleReconnect(){if(this.reconnectAttempts>=this.config.reconnectAttempts){console.error("Max reconnection attempts reached");return}this.reconnectAttempts++;const r=this.config.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);this.reconnectTimer=window.setTimeout(()=>{console.log(`Attempting to reconnect (${this.reconnectAttempts}/${this.config.reconnectAttempts})`),this.connect().catch(s=>{console.error("Reconnection failed:",s)})},r)}setConnectionStatus(r){this.connectionHandlers.forEach(s=>s(r==="connected"))}onMessage(r){return this.messageHandlers.add(r),()=>this.messageHandlers.delete(r)}onConnectionChange(r){return this.connectionHandlers.add(r),()=>this.connectionHandlers.delete(r)}isConnected(){var r;return((r=this.ws)==null?void 0:r.readyState)===WebSocket.OPEN}getConnectionStatus(){var r,s,i;return((r=this.ws)==null?void 0:r.readyState)===WebSocket.OPEN?"connected":((s=this.ws)==null?void 0:s.readyState)===WebSocket.CONNECTING?"connecting":((i=this.ws)==null?void 0:i.readyState)===WebSocket.CLOSED?"disconnected":"error"}}let K=null;const yt=n=>{const{config:r}=be(),s=R.useRef(null),i=V(a=>a.sessions[n]),f=V(a=>a.connectionStatus),b=V(a=>a.connectionError),g=V(a=>a.setSessionStatus),w=V(a=>a.addMessage),_=V(a=>a.setSessionError),S=V(a=>a.clearSession),c=V(a=>a.setConnectionStatus),d=V(a=>a.setConnectionError),v=R.useCallback(()=>(K||(K=new ke(r),s.current=K,K.onConnectionChange(a=>{c(a?"connected":"disconnected")}),K.onMessage(a=>{a.error?(_(n,a.error),g(n,"error")):a.response&&(w(n,{role:"assistant",content:a.response}),g(n,"idle"))})),K),[r,c,_,g,w,n]);R.useEffect(()=>{const a=v();return i||g(n,"idle"),a.getConnectionStatus()==="disconnected"&&a.connect().catch(T=>{d(T.message)}),()=>{}},[n,i,v,g,d]);const l=R.useCallback(async a=>{const T=v();try{g(n,"streaming"),w(n,{role:"user",content:a}),await T.send(n,a)}catch(C){const y=C instanceof Error?C.message:"Unknown error";_(n,y),g(n,"error")}},[n,v,g,w,_]),m=R.useCallback(()=>{S(n)},[n,S]);return{messages:(i==null?void 0:i.messages)||[],status:(i==null?void 0:i.status)||"idle",connectionStatus:f,connectionError:b,isConnected:f==="connected",isLoading:(i==null?void 0:i.status)==="connecting"||(i==null?void 0:i.status)==="streaming",isStreaming:(i==null?void 0:i.status)==="streaming",error:(i==null?void 0:i.error)||b,send:l,clear:m}};D.LeanPromptProvider=ut,D.WebSocketManager=ke,D.useLeanPrompt=yt,D.useLeanPromptContext=be,D.useLeanPromptStore=V,Object.defineProperty(D,Symbol.toStringTag,{value:"Module"})});
